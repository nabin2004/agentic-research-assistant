name: Build and Deploy Paper to GitHub Pages

permissions:
  contents: read
  pages: write
  id-token: write

on:
  push:
    branches: [ master ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Install TeX
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-latex-recommended texlive-latex-extra texlive-fonts-recommended texlive-bibtex-extra
      - name: Build LaTeX paper
        run: |
          chmod +x scripts/build_paper.sh
          ./scripts/build_paper.sh
      - name: Prepare Pages artifact
        run: |
          mkdir -p deploy
          cp latex/main.pdf deploy/
          cat > deploy/index.html <<'HTML'
          <!doctype html>
          <html>
          <head><meta charset="utf-8"><title>Paper PDF</title></head>
          <body style="margin:0">
            <div style="position:fixed;top:0;left:0;right:0;bottom:0">
              <embed src="main.pdf" type="application/pdf" width="100%" height="100%"></embed>
            </div>
          </body>
          </html>
          HTML
      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: deploy
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v1
